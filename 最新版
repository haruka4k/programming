from sympy import symbols, simplify

# 変数 n を定義
n = symbols('n')

# 各ルールに対して代数操作を定義
def apply_rule(expr, rule):
    if rule == 1:
        return (2 * expr - 1) / 3
    elif rule == 2:
        return (4 * expr) / 3
    elif rule == 3:
        return 4 * expr + 2
    else:
        raise ValueError("ルールは1〜3の整数で指定してください")

# --- 入力 ---
rules_input = input("操作ルールをカンマ区切りで入力（例: 1,2,3）: ")
rules = [int(x.strip()) for x in rules_input.split(",")]

# 初期値は代数変数 n
expr = n

# ルールを順に適用
for rule in rules:
    expr = apply_rule(expr, rule)

# 結果の出力（代数式の構文）
simplified = simplify(expr)
print("\n適用された操作系列に対応する関数 f(n):")
print(f"f(n) = {simplified}")
